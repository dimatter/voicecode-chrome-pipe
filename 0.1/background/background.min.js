// Generated by CoffeeScript 1.10.0
(function() {
  var vc;

  vc = {
    tabLinkInteger: (function() {
      var tabs;
      tabs = {};
      return {
        reset: function(tabId) {
          return tabs[tabId] = 0;
        },
        get: function(tabId) {
          if (tabs[tabId] == null) {
            tabs[tabId] = 0;
          }
          return ++tabs[tabId];
        }
      };
    })()
  };

  chrome.tabs.onUpdated.addListener(function(tabId, changeInfo, tab) {
    var message;
    if (changeInfo.status === 'complete') {
      message = {
        type: 'invoke',
        namespace: 'vc',
        method: 'loadComplete',
        argumentsObject: null
      };
      return chrome.tabs.sendMessage(tabId, message);
    }
  });

  chrome.runtime.onMessage.addListener(function(request, sender, sendResponse) {
    console.info('<', request, sender);
    if (request.parameters == null) {
      request.parameters = {};
    }
    _(request.parameters).extend({
      frameId: sender.frameId,
      tabId: sender.tab.id,
      windowId: sender.tab.windowId
    });
    switch (request.destination) {
      case 'voicecode':
        window.socket.send({
          type: request.type,
          parameters: request.parameters
        });
        return sendResponse({
          okay: true
        });
      case 'background':
        return sendResponse({
          okay: true
        });
    }
  });

  window.socket = new WebSocketWrapper;

}).call(this);

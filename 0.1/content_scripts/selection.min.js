(function(){var e,t,n=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};e=function(){function e(){return null!=t?t:(this.visibleTextNodes=[],voiceCodeForeground.installListener(window,"resize",function(e){return function(){return e.rescan()}}(this)),voiceCodeForeground.installListener(window,"scroll",function(e){return function(){return e.rescan()}}(this)),DomUtilities.documentReady(function(e){return function(){return e.rescan()}}(this)),void(t=this))}var t;return t=null,e.prototype.rescan=function(){return this.clear(),this.searchVisibleTextNodes()},e.prototype.clear=function(){return this.visibleTextNodes=[]},e.prototype.searchVisibleTextNodes=function(){var e,t,r,o,i;for(i=[],o=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT),t=[];e=o.nextNode();)3===e.nodeType&&(n.call(i,e)>=0||(r=e.data.trim(),0<r.length&&(i.push(e),t.push(DomUtilities.getVisibleClientRect(e.parentNode)?this.visibleTextNodes.push(e):void 0))));return t},e}(),t=function(){function e(){return null!=t?t:(t=this,this.cache={},this.currentPosition={},this.previousSearchTerm=null,void voiceCodeForeground.installListener(window,"click",function(e){return function(){return e.reset()}}(this)))}var t;return t=null,e.prototype.select=function(e){var t,n,r,o,i,s,c,u,d,l;return s=_.extend({direction:"forward",mode:"select"},e),d=s.target,t=s.direction,i=s.mode,null===d&&(d=this.previousSearchTerm),null==d?void console.error("Nothing to search for!"):("Range"===document.getSelection().type&&_.isEmpty(this.currentPosition)&&(u=null,_.find(domCache.visibleTextNodes,function(e,t){return document.getSelection().focusNode===e?(u=t,!0):!1}),document.getSelection().extentNode!==document.getSelection().baseNode?(n=null,_.find(domCache.visibleTextNodes.reverse(),function(e,t){return document.getSelection().extentNode===e?(n=t,!0):!1}),domCache.visibleTextNodes.reverse()):n=u,null!=u&&null!=n&&(this.range=document.getSelection().getRangeAt(0),this.reset(),this.currentPosition={forward:u,backward:n})),r=null,o=function(e){return function(n,o){var i,s,c,u;return i="forward"===t?d:"("+d+")(?![\\s\\S]*"+d+"[\\s\\S]*)",d!==e.previousSearchTerm||_.isEmpty(e.currentPosition)||("forward"===t?n===e.range.endContainer&&(c=e.range.endOffset,i="([\\s\\S]{"+c+",})"+d):n===e.range.startContainer&&(u=n.textContent.length-e.range.startOffset,i=d+"[\\s\\S]{"+u+",}$")),i=new RegExp(i,"mi"),s=i.exec(n.textContent),null!=s?(r={node:n,position:o,offset:s.index},!0):!1}}(this),"forward"===t?(c=this.currentPosition[t]||0,l=function(e){return function(n){var r;return null==(r=e.currentPosition)[t]&&(r[t]=0),e.currentPosition[t]+=n.position}}(this),_.find(domCache.visibleTextNodes.slice(c),o)):(c=this.currentPosition[t]||this.currentPosition.forward+1||_.size(domCache.visibleTextNodes),l=function(e){return function(n){var r;return null==(r=e.currentPosition)[t]&&(r[t]=e.currentPosition.forward||_.size(domCache.visibleTextNodes)),e.currentPosition[t]-=n.position}}(this),_.find(domCache.visibleTextNodes.slice(0,c).reverse(),o)),null!=r?(l(r),"select"===i?(this.deselectAll(),this.range=document.createRange(),this.range.setStart(r.node,r.offset),this.range.setEnd(r.node,r.offset+d.length)):"forward"===t?this.range.setEnd(r.node,r.offset+d.length):this.range.setStart(r.node,r.offset),document.getSelection().addRange(this.range),this.previousSearchTerm=d):void 0)},e.prototype.extend=function(e){return this.select(_.extend(e,{mode:"extend"}))},e.prototype.reset=function(){return this.currentPosition={}},e.prototype.deselectAll=function(){return document.getSelection().removeAllRanges()},e}(),window.SelectionController=new t,window.domCache=new e}).call(this);